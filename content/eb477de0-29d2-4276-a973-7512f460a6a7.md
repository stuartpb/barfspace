# Taking care of pacdiffs

I want to enable zstd for zswap, but I don't see it suggested in comments.

I decide to `yay -S pacman-contrib` and `sudo bash -c 'DIFFPROG=meld pacdiff'` (though, looking into it, I could also just inline the env variables)

I merge the new header comments for `/etc/fstab` with the old one, then redo all spacing in the definition lines to match the new no-tabs headings. (afterwards, I open a new tab and `sudo merge -a` to confirm there were no syntax errors - it actually turns out I forgot a comment character, which probably would have been ignored and fine, but better safe then sorry).

I removed `/etc/group.pacnew` because it was just the root group?? I guess the shipping set of groups is probably a lot simpler these days

same goes for `/etc/gshadow`, only one group, like, why

merged in new header for `/etc/hosts` and removed pacnew

skipping `/etc/passwd` with removal for same reasons

can't really put this in `/etc/resolv.conf` when it's generated by NetworkManager (will I someday kill that subsystem? replace it with something that better handles mDNS?)

```
# Resolver configuration file.
# See resolv.conf(5) for details.
```

here's a weird thing from `/etc/shadow`, but I daren't change it: `root::14871::::::` is the only line in the pacnew, but, in the current, I have `root:!:16879::::::`, along with a bunch of other users that are `14871` (like `bin`, why is that a user?)

taking `/etc/shells` from the former to the latter:

```
#
# /etc/shells
#

/bin/sh
/bin/bash

# End of file
/usr/bin/git-shell
```

```

```

## locale.gen

porting our uncommented lines over (ie. just `en_US.UTF-8 UTF-8`)

then, after reviewing, Changes -> Merge All from Left

What this does:

- makes a bunch of additions
- [removes iw_IL](https://patchwork.ozlabs.org/patch/608260/) and [pap_AN](https://lists.gnu.org/archive/html/info-gnu/2016-08/msg00003.html) per pacnew

saved changes (the the non-pacnew) before saving, then removed

## moving on

merged some stuff in from i3, think I didn't really have any customizations so it was pretty much a line-for-line pull from pacnew

merging new for `/etc/ImageMagick-6/delegates.xml`

## a side thought

it'd be nice to have a flag to just delete if, after running View, the pacnew and current are identical (ie. the "pacnew" wouldn't be created, if the content was the package's new content)

that way you can save merged-back changes in the tool to save a keystroke after closing

## back to imagemagick config

skipping the tool and just hitting "O" to overwrite `/etc/ImageMagick-6/policy.xml`, which removes this example (after "we do not want users reading from HTTP") for some reason:

```
  Lets prevent users from executing any image filters:

    <policy domain="filter" rights="none" pattern="*" />
```

and adds a few more commented domains, plus `<policy domain="delegate" rights="none" pattern="gs" />` uncommented (doing something?)

## another side thought

a couple progress bars would be nice

## back to imagemagick

overwrite for `/etc/ImageMagick-6/type.xml` adds `<include file="type-dejavu.xml" />`

there's a whole bunch more fonts in `/etc/ImageMagick-6/type-dejavu.xml`, so many Meld has trouble

A bunch of cleaner lines for `type-ghostscript`, too

## security

adding more suggestions in overwrite of `/etc/security/pwquality.conf`

## libvirt

`/etc/libvirt/nwfilter/clean-traffic-gateway.xml` opens:

```
<!--
WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE
OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:
  virsh nwfilter-edit clean-traffic-gateway
or other application using the libvirt API.
-->

<filter name='clean-traffic-gateway' chain='root'>
  <uuid>42b80d36-b370-435c-a15e-a14859243a07</uuid>
  <filterref filter='no-mac-spoofing'/>
  <filterref filter='no-ip-spoofing'/>
  <filterref filter='no-arp-spoofing'/>
  <rule action='accept' direction='inout' priority='-500'>
    <mac protocolid='arp'/>
  </rule>
  <rule action='accept' direction='in' priority='500'>
    <mac srcmacaddr='$GATEWAY_MAC'/>
  </rule>
  <rule action='accept' direction='out' priority='500'>
    <mac dstmacaddr='$GATEWAY_MAC'/>
  </rule>
  <filterref filter='no-other-l2-traffic'/>
  <filterref filter='qemu-announce-self'/>
</filter>
```

so, what the heck, overwrite it, this default looks cleaner than the autogenerated thing, and it sounds like it should regenerate:

```
<filter name='clean-traffic-gateway'>
    <!-- An example of a traffic filter enforcing clean traffic
            from a VM by
              - preventing MAC spoofing -->
    <filterref filter='no-mac-spoofing'/>

    <!-- preventing IP spoofing on outgoing -->
    <filterref filter='no-ip-spoofing'/>

    <!-- preventing ARP spoofing/poisoning -->
    <filterref filter='no-arp-spoofing'/>

    <!-- accept all other incoming and outgoing ARP traffic -->
    <rule action='accept' direction='inout' priority='-500'>
        <mac protocolid='arp'/>
    </rule>

    <!-- accept traffic only from specified MAC address -->
    <rule action='accept' direction='in'>
        <mac match='yes' srcmacaddr='$GATEWAY_MAC'/>
    </rule>

    <!-- allow traffic only to specified MAC address -->
    <rule action='accept' direction='out'>
        <mac match='yes' dstmacaddr='$GATEWAY_MAC'/>
    </rule>

    <!-- preventing any other traffic than between specified MACs
    and ARP -->
    <filterref filter='no-other-l2-traffic'/>

    <!-- allow qemu to send a self-announce upon migration end -->
    <filterref filter='qemu-announce-self'/>
</filter>
```

overwriting `/etc/libvirt/qemu.conf` as I've never really touched it

removing `/etc/libvirt/qemu/networks/default.xml.pacnew` because my existing auto-generated one has more detail

## `/etc/pacman.conf`

updating example commented XfreCommand for curl

[removing UseDelta](https://wiki.archlinux.org/index.php/Deltup) due to removal due to CVE

keeping my uncommented multilib

## `/etc/pacman.d/mirrorlist`

removing pacnew as this is handled by reflector

## `/usr/bin/pinentry`

oh god what. overwrite. it's a script that replaces an ELF binary. why was this pacnew'd
