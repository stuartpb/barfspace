# Post-Helm-Controller-revamp Stubernetes spinup checklist

- ensure all appropriate teardown has been done:
  - `bash hack/teardown/weave-teardown.sh`
    - or at least `rm -rf /etc/cni/net.d`
  - `bash hack/teardown/ceph-teardown.sh`
    - or at least `rm -rf /var/lib/rook`
    - all the other device teardown is only necessary if rook-ceph progressed that far
  - reboot, or at least reset iptables with `iptables -F`

## after node rebuild/teardown

- `kubeadm init` on mpi-rose
- `bash hack/cluster-setup/yoink-admin-credentials.sh mpi-rose`
- `kubeadm join` on other nodes while copying that into the YAML
- `bash hack/cluster-setup/label-nodes.sh` once all nodes have joined
- roll out core and **secrets**
  - `kubectl apply -f core/weave-net.yaml`
  - `kubectl apply -f core/gotk-system.yaml`
  - `kubectl apply -f secrets/actual/hornhorse-cloudflare.secrets.yaml`
  - `kubectl apply -f core/stubernetes-system.yaml`

## consequences to not following this

- if you forget to deploy the secrets
  - cert-manager will make garbage artifacts you have to manually delete
    - and potentially bust your request limits with Let's Encrypt
- if you forget to label the nodes
  - contour's envoys and rook-ceph won't roll out
    - which will make prometheus slow to init
    - and ingresses absent
- if you don't deploy weave-net promptly (like, within 45 minutes)
  - nodes will be tainted as unreachable, and from what I can tell they won't reconcile, even six hours later
